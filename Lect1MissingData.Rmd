---
title: "Getting an Overview / Missing Data"
output: 
  slidy_presentation:
    css: styles5293.css
    fig_height: 4
    fig_width: 6
    df_print: kable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE, message = FALSE)
```


```{r, echo = FALSE}
# Add NAs to mtcars dataset
set.seed(5702)
mycars <- mtcars
mycars[,"gear"] <- NA
mycars[10:20, 3:5] <- NA
for (i in 1:10) mycars[sample(32,1), sample(11,1)] <- NA
```

## Final project

CDC data: https://wonder.cdc.gov/

(Contact me if you would like to work with this data.)

## Final project feedback

Please email me if you would like to receive feedback / suggestions in class.  I will look at Homework #3 and any additional information or questions you provide in the email.




## Getting started

> - SAMPLE

> - SUBSET

> - Start with one variable at a time, build up

> - Focus on the questions

## Types of missing data

> - MCAR: Missing Completely At Random

> - MNAR: Missing Not At Random

> - MAR: Missing At Random (bad name)

## Missing Data in R
```{r}
x <- "NA"
is.na(x)
```


## Data
```{r}
head(mtcars)
```


## Method 1: geom_tile
```{r}
library(tidyr)
library(dplyr)
library(ggplot2)
library(tibble)
library(viridis)
tidycars <- mycars %>% 
    rownames_to_column("id") %>% 
    gather(key, value, -id) %>% 
    mutate(missing = ifelse(is.na(value), "yes", "no"))
head(tidycars)
```

## Method 1: geom_tile
```{r}
ggplot(tidycars, aes(x = key, y = id, fill = missing)) +
  geom_tile(color = "white") + 
  scale_fill_viridis(discrete = TRUE)
```


## Method 2: image(missing_data.frame())
```{r, echo = -1}
# Note: `gear` is left out since all values are NA
library(mi)
image(missing_data.frame(mycars))
```


## Method 3: visna()

Each row is a *pattern* of missing values
```{r}
library(extracat)
visna(mycars)
```

## visna() w/ row sort

Sorted by most common to least common missing *pattern* (top to bottom)

```{r}
visna(mycars, sort = "r")
```

## visna() w/ column sort

Sorted by *variable* with the most to least missing values (left to right)

```{r}
visna(mycars, sort = "c")
```

## visna() w/ row & column sort


```{r}
visna(mycars, sort = "b")
```


## NYC School data
```{r}
df <- read.csv("SAT2010.csv", na.strings = "s",
               check.names = FALSE)
head(df)
dim(df)
```


## NYC School data
```{r}
visna(df)
```

## NYC School data

Does the proportion of schools with missing data vary by borough?
